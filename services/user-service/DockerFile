FROM node:20-alpine

WORKDIR /app

# Copier les fichiers de configuration package
COPY package*.json ./
COPY tsconfig*.json ./
COPY nest-cli.json ./

# Installer les dépendances
RUN npm install

# Copier le schéma Prisma et générer le client
COPY prisma ./prisma
RUN npx prisma generate

# Copier tout le code source
COPY src ./src

EXPOSE 3005

# Utiliser le mode développement avec watch
CMD ["npm", "run", "start:dev"]